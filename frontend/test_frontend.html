<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend API Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">í”„ë¡ íŠ¸ì—”ë“œ API ì—°ê²° í…ŒìŠ¤íŠ¸</h1>

        <div class="bg-white rounded-lg shadow p-6 mb-4">
            <h2 class="text-xl font-semibold mb-4">ë°±ì—”ë“œ ì—°ê²° ìƒíƒœ</h2>
            <button onclick="testBackend()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ë°±ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸
            </button>
            <div id="backend-status" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-4">
            <h2 class="text-xl font-semibold mb-4">í‚¤ë³´ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</h2>
            <button onclick="getKeyboards()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                í‚¤ë³´ë“œ ëª©ë¡ ì¡°íšŒ
            </button>
            <div id="keyboards-list" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <input type="text" id="username" placeholder="Username" class="border px-3 py-2 rounded mr-2" value="admin">
            <input type="password" id="password" placeholder="Password" class="border px-3 py-2 rounded mr-2" value="admin123">
            <button onclick="testLogin()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
            </button>
            <div id="login-status" class="mt-4"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';

        async function testBackend() {
            const statusDiv = document.getElementById('backend-status');
            statusDiv.innerHTML = '<p class="text-gray-600">ì—°ê²° ì¤‘...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();

                if (data.status === 'healthy') {
                    statusDiv.innerHTML = `
                        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                            âœ“ ë°±ì—”ë“œ ì„œë²„ ì •ìƒ ì‘ë™ ì¤‘
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        âœ— ì—°ê²° ì‹¤íŒ¨: ${error.message}
                    </div>
                `;
            }
        }

        async function getKeyboards() {
            const listDiv = document.getElementById('keyboards-list');
            listDiv.innerHTML = '<p class="text-gray-600">ë¡œë”© ì¤‘...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/api/keyboards`);
                const data = await response.json();

                if (data.keyboards.length === 0) {
                    listDiv.innerHTML = '<p class="text-gray-500">ë“±ë¡ëœ í‚¤ë³´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    const keyboardsHtml = data.keyboards.map(kb => `
                        <div class="border-b py-3">
                            <h3 class="font-semibold">${kb.name}</h3>
                            <p class="text-gray-600">ê°€ê²©: ${kb.price ? 'â‚©' + kb.price.toLocaleString() : 'ê°€ê²© ë¯¸ì •'}</p>
                            <p class="text-sm text-gray-500">
                                ${kb.tags.is_wireless ? 'ğŸ”Œ ë¬´ì„ ' : ''}
                                ${kb.tags.has_ortholinear ? 'âŒ¨ï¸ ì˜¤ì†Œë¦¬ë‹ˆì–´' : ''}
                                ${kb.tags.has_tenting ? 'ğŸ“ í‹¸íŒ…' : ''}
                                ${kb.tags.has_display ? 'ğŸ–¥ï¸ ë””ìŠ¤í”Œë ˆì´' : ''}
                            </p>
                        </div>
                    `).join('');

                    listDiv.innerHTML = `
                        <div class="bg-green-50 border border-green-200 p-3 rounded mb-3">
                            ì´ ${data.total}ê°œì˜ í‚¤ë³´ë“œ
                        </div>
                        <div>${keyboardsHtml}</div>
                    `;
                }
            } catch (error) {
                listDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        âœ— ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        async function testLogin() {
            const statusDiv = document.getElementById('login-status');
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            statusDiv.innerHTML = '<p class="text-gray-600">ë¡œê·¸ì¸ ì¤‘...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                            âœ“ ë¡œê·¸ì¸ ì„±ê³µ!<br>
                            <span class="text-xs">í† í°: ${data.access_token.substring(0, 50)}...</span>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                            âœ— ë¡œê·¸ì¸ ì‹¤íŒ¨: ${data.detail || 'ì¸ì¦ ì˜¤ë¥˜'}
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        âœ— ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
        window.onload = () => {
            testBackend();
        };
    </script>
</body>
</html>
